<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SVG Interactive Sugoroku</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
        }
        svg {
            background-color: white;
            border: 2px solid #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
            user-select: none; /* æ–‡å­—é¸æŠã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ */
        }
        
        /* --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚³ãƒï¼‰ --- */
        .player-piece {
            transition: cx 0.3s ease, cy 0.3s ease;
            fill: #ff4757;
            stroke: #fff;
            stroke-width: 2px;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
            pointer-events: none; /* ã‚³ãƒãŒãƒã‚¹ã®ã‚¯ãƒªãƒƒã‚¯ã‚’é‚ªé­”ã—ãªã„ã‚ˆã†ã« */
        }

        /* --- ãƒã‚¹ã®åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        .step-rect {
            fill: #eccc68;
            stroke: #333;
            stroke-width: 1px;
            transition: all 0.2s; /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            cursor: pointer;      /* æŒ‡ã®ã‚«ãƒ¼ã‚½ãƒ« */
        }
        
        /* ãƒã‚¹ã®ç¨®é¡ã”ã¨ã®è‰² */
        .step-event { fill: #70a1ff; }
        .step-trap { fill: #ff6b81; }

        /* --- â˜…ã“ã“ãŒè¿½åŠ ã—ãŸãƒ›ãƒãƒ¼æ¼”å‡º --- */
        .step-rect:hover {
            stroke: #ff9f43;    /* æ ç·šã‚’ã‚ªãƒ¬ãƒ³ã‚¸ã« */
            stroke-width: 4px;  /* æ ç·šã‚’å¤ªã */
            fill-opacity: 0.9;  /* å°‘ã—ã ã‘é€æ˜æ„Ÿã‚’å‡ºã™ */
        }

        button {
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: #2ed573;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <h2>SVGã™ã”ã‚ãï¼ˆãƒã‚¦ã‚¹ã‚’ä¹—ã›ã¦ã¿ã¦ï¼ï¼‰</h2>
    <div id="msg">ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ã€‚ãƒã‚¹ã«ãƒã‚¦ã‚¹ã‚’ä¹—ã›ã‚‹ã¨èª¬æ˜ãŒå‡ºã¾ã™ã€‚</div>
    
    <svg id="gameBoard" width="600" height="250"></svg>
    
    <button id="diceBtn" onclick="turn()">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹ ğŸ²</button>

    <script>
        const svg = document.getElementById('gameBoard');
        const msgDiv = document.getElementById('msg');
        const diceBtn = document.getElementById('diceBtn');
        const svgNS = "http://www.w3.org/2000/svg";

        // ãƒã‚¹ç›®ã®ãƒ‡ãƒ¼ã‚¿
        const steps = [
            { x: 50,  y: 125, type: 'start', text: 'S' },
            { x: 110, y: 125 },
            { x: 170, y: 125, type: 'event', text: 'ï¼Ÿ', effect: 'warp' },
            { x: 230, y: 125 },
            { x: 290, y: 125, type: 'trap',  text: 'æˆ»', effect: 'back' },
            { x: 350, y: 125 },
            { x: 410, y: 125 },
            { x: 470, y: 125 },
            { x: 550, y: 125, type: 'goal',  text: 'G' }
        ];

        let currentPos = 0;
        let playerElem = null;

        function initGame() {
            drawBoard();
            createPlayer();
        }

        async function turn() {
            if (currentPos >= steps.length - 1) return;
            diceBtn.disabled = true;
            
            const dice = Math.floor(Math.random() * 3) + 1;
            msgDiv.innerText = `å‡ºãŸç›®: ${dice}ï¼ é€²ã¿ã¾ã™...`;

            for (let i = 0; i < dice; i++) {
                if (currentPos >= steps.length - 1) break;
                currentPos++;
                updatePlayerPos();
                await wait(400);
            }

            await checkTileEvent();

            if (currentPos === steps.length - 1) {
                msgDiv.innerText = "ã‚´ãƒ¼ãƒ«ï¼ï¼ãŠã‚ã§ã¨ã†ï¼ğŸ‰";
            } else {
                msgDiv.innerText += " ã‚ãªãŸã®ç•ªã§ã™ã€‚";
                diceBtn.disabled = false;
            }
        }

        function drawBoard() {
            // èƒŒæ™¯ã®ç·š
            const line = document.createElementNS(svgNS, "line");
            line.setAttribute("x1", steps[0].x);
            line.setAttribute("y1", steps[0].y);
            line.setAttribute("x2", steps[steps.length-1].x);
            line.setAttribute("y2", steps[steps.length-1].y);
            line.setAttribute("stroke", "#ccc");
            line.setAttribute("stroke-width", "5");
            svg.appendChild(line);

            // ãƒã‚¹ã‚’æã
            steps.forEach(step => {
                const rect = document.createElementNS(svgNS, "rect");
                rect.setAttribute("x", step.x - 20);
                rect.setAttribute("y", step.y - 20);
                rect.setAttribute("width", 40);
                rect.setAttribute("height", 40);
                rect.setAttribute("rx", 5);

                // ã‚¯ãƒ©ã‚¹ã‚’å‰²ã‚Šå½“ã¦ï¼ˆã“ã‚Œã§CSSã®hoverãŒåŠ¹ãã‚ˆã†ã«ãªã‚Šã¾ã™ï¼‰
                let className = "step-rect";
                if (step.type === 'event') className += " step-event";
                if (step.type === 'trap') className += " step-trap";
                rect.setAttribute("class", className);

                // â˜…ã“ã“ã«ãƒ›ãƒãƒ¼æ™‚ã®èª¬æ˜æ–‡ï¼ˆãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼‰ã‚’è¿½åŠ 
                const title = document.createElementNS(svgNS, "title");
                if (step.type === 'trap') title.textContent = "ã€å±é™ºã€‘æ­¢ã¾ã‚‹ã¨æˆ»ã•ã‚Œã¾ã™";
                else if (step.type === 'event') title.textContent = "ã€ãƒãƒ£ãƒ³ã‚¹ã€‘ãƒ¯ãƒ¼ãƒ—ï¼";
                else if (step.type === 'start') title.textContent = "ã“ã“ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ";
                else if (step.type === 'goal') title.textContent = "ç›®æŒ‡ã›ã‚´ãƒ¼ãƒ«";
                else title.textContent = "æ™®é€šã®ãƒã‚¹";
                rect.appendChild(title);

                svg.appendChild(rect);

                // ãƒã‚¹ã®ä¸Šã®æ–‡å­—
                if (step.text) {
                    const text = document.createElementNS(svgNS, "text");
                    text.setAttribute("x", step.x);
                    text.setAttribute("y", step.y + 5);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("font-weight", "bold");
                    text.style.pointerEvents = "none"; // æ–‡å­—ãŒé‚ªé­”ã—ãªã„ã‚ˆã†ã«
                    text.textContent = step.text;
                    svg.appendChild(text);
                }
            });
        }

        function createPlayer() {
            playerElem = document.createElementNS(svgNS, "circle");
            playerElem.setAttribute("r", 15);
            playerElem.setAttribute("class", "player-piece");
            updatePlayerPos();
            svg.appendChild(playerElem);
        }

        function updatePlayerPos() {
            const posData = steps[currentPos];
            playerElem.setAttribute("cx", posData.x);
            playerElem.setAttribute("cy", posData.y);
        }

        async function checkTileEvent() {
            const tile = steps[currentPos];
            if (tile.effect === 'back') {
                msgDiv.innerText = "ç½ ã ï¼1ãƒã‚¹æˆ»ã•ã‚Œã‚‹ï¼";
                await wait(800);
                currentPos--;
                updatePlayerPos();
            } else if (tile.effect === 'warp') {
                msgDiv.innerText = "ãƒ¯ãƒ¼ãƒ—ï¼1ãƒã‚¹é€²ã‚€ï¼";
                await wait(800);
                currentPos++;
                updatePlayerPos();
            }
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        initGame();
    </script>
</body>
</html>
